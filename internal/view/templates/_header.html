{{ define "_header.html" }}
<header class="main-header">
  <div class="logo">
    {{ if and .IsLoggedIn (eq .User.Tipo "cliente") }}
    <a href="/cliente/dashboard">Meu Cupcake</a>
    {{ else if and .IsLoggedIn (eq .User.Tipo "lojista") }}
    <a href="/lojista/dashboard">Meu Cupcake</a>
    {{ else }}
    <a href="/">Meu Cupcake</a>
    {{ end }}
  </div>

  <!-- NAV DESKTOP -->
  <nav class="nav-links-desktop" aria-label="NavegaÃ§Ã£o Principal">
    {{ if and .IsLoggedIn (eq .User.Tipo "lojista") }}
    <a href="/lojista/dashboard">Painel</a>
    <a href="/lojista/vendas">Vendas</a>
    <a href="/lojista/cupcakes">Cupcakes</a>
    <a href="/perfil">Meu Perfil</a>
    <a href="/logout" class="btn btn-primary">Sair</a>

    {{ else if and .IsLoggedIn (eq .User.Tipo "cliente") }} {{ if ne .ActivePage
    "vitrine" }}
    <a href="/carrinho" class="cart-link">
      <span class="cart-icon">ðŸ›’</span>
      <span
        class="cart-badge"
        {{
        if
        eq
        .CartItemCount
        0
        }}style="display:none;"
        {{
        end
        }}
        >{{ .CartItemCount }}</span
      >
    </a>
    <a href="/vitrine" class="btn btn-secondary">Vitrine</a>
    {{ end }}
    <a href="/perfil" class="btn btn-secondary">Meu Perfil</a>
    <a href="/logout" class="btn btn-primary">Sair</a>

    {{ else }} {{ if ne .ActivePage "vitrine" }}
    <a href="/vitrine" class="btn btn-secondary">Vitrine</a>
    {{ end }}
    <a href="/carrinho" class="cart-link">
      <span class="cart-icon">ðŸ›’</span>
      <span
        class="cart-badge"
        {{
        if
        eq
        .CartItemCount
        0
        }}style="display:none;"
        {{
        end
        }}
        >{{ .CartItemCount }}</span
      >
    </a>
    <a href="/login" class="btn btn-secondary">Entrar</a>
    <a href="/cadastro" class="btn btn-primary">Cadastrar</a>
    {{ end }}
  </nav>

  <!-- MOBILE CONTROLS -->
  <div class="mobile-controls">
    {{ if not (and .IsLoggedIn (eq .User.Tipo "lojista")) }}
    <a href="/carrinho" class="cart-link cart-link-mobile">
      <span class="cart-icon">ðŸ›’</span>
      <span
        class="cart-badge"
        {{
        if
        eq
        .CartItemCount
        0
        }}style="display:none;"
        {{
        end
        }}
        >{{ .CartItemCount }}</span
      >
    </a>
    {{ end }}
    <button
      id="hamburger-btn"
      class="hamburger-btn"
      aria-label="Abrir menu"
      aria-expanded="false"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <!-- MOBILE MENU -->
  <nav id="nav-menu-mobile" class="nav-links-mobile" aria-hidden="true">
    <button id="close-btn" class="close-btn" aria-label="Fechar menu">
      &times;
    </button>

    {{ if and .IsLoggedIn (eq .User.Tipo "lojista") }}
    <a href="/lojista/dashboard">Painel</a>
    <a href="/lojista/vendas">Vendas</a>
    <a href="/lojista/cupcakes">Cupcakes</a>
    <a href="/perfil">Meu Perfil</a>
    <div class="nav-separator"></div>
    <a href="/logout" class="btn btn-primary btn-mobile">Sair</a>

    {{ else if and .IsLoggedIn (eq .User.Tipo "cliente") }} {{ if ne .ActivePage
    "vitrine" }}<a href="/vitrine">Vitrine</a>{{ end }}
    <a href="/carrinho" class="cart-link">
      <span class="cart-text">Carrinho</span>
      <span
        class="cart-badge-mobile"
        {{
        if
        eq
        .CartItemCount
        0
        }}style="display:none;"
        {{
        end
        }}
        >{{ .CartItemCount }}</span
      >
    </a>
    <a href="/cliente/dashboard">Minha Conta</a>
    <a href="/perfil">Meu Perfil</a>
    <div class="nav-separator"></div>
    <a href="/logout" class="btn btn-primary btn-mobile">Sair</a>

    {{ else }} {{ if ne .ActivePage "vitrine" }}<a href="/vitrine">Vitrine</a>{{
    end }}
    <a href="/carrinho" class="cart-link">
      <span class="cart-text">Carrinho</span>
      <span
        class="cart-badge-mobile"
        {{
        if
        eq
        .CartItemCount
        0
        }}style="display:none;"
        {{
        end
        }}
        >{{ .CartItemCount }}</span
      >
    </a>
    <div class="nav-separator"></div>
    <a href="/login" class="btn btn-secondary btn-mobile">Entrar</a>
    <a href="/cadastro" class="btn btn-primary btn-mobile">Cadastrar</a>
    {{ end }}
  </nav>
</header>

<style>
  /* BASE */
  .main-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    background: white;
    border-bottom: 2px solid #fde2ed;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    z-index: 100;
  }
  .logo a {
    text-decoration: none;
    color: #ff69b4;
    font-size: 1.5rem;
    font-weight: bold;
  }

  /* DESKTOP NAV */
  .nav-links-desktop {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }
  .nav-links-desktop a:not(.btn) {
    text-decoration: none;
    color: #333;
    font-weight: 500;
    transition: color 0.2s ease;
  }
  .nav-links-desktop a:not(.btn):hover {
    color: #ff69b4;
  }

  /* BUTTONS */
  .btn {
    padding: 8px 16px;
    border-radius: 5px;
    font-weight: bold;
    border: 1px solid transparent;
    text-decoration: none;
  }
  .btn-primary {
    background: #ff69b4;
    color: white;
    border-color: #ff69b4;
  }
  .btn-primary:hover {
    background: #ff85c1;
  }
  .btn-secondary {
    background: #6c757d;
    color: white;
    border-color: #6c757d;
  }
  .btn-secondary:hover {
    background: #5a6268;
  }

  /* CART STYLE (âœ… Restaurado) */
  .cart-link {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    color: #333;
    text-decoration: none;
  }
  .cart-icon {
    font-size: 1.5rem;
  }
  .cart-badge {
    position: absolute;
    top: -5px;
    right: -12px;
    background: red;
    color: white;
    border-radius: 50%;
    padding: 2px 5px;
    font-size: 0.7rem;
    font-weight: bold;
    line-height: 1;
    min-width: 14px;
    text-align: center;
  }
  .cart-badge-mobile {
    background: red;
    color: white;
    border-radius: 50%;
    padding: 2px 5px;
    font-size: 0.75rem;
    font-weight: bold;
    line-height: 1;
    margin-left: 0.4rem;
  }

  /* MOBILE */
  .mobile-controls {
    display: none;
    align-items: center;
    gap: 0.5rem;
  }
  .hamburger-btn {
    display: flex;
    flex-direction: column; /* âœ… forÃ§a as 3 linhas ficarem empilhadas */
    justify-content: center;
    align-items: center;
    gap: 4px; /* espaÃ§amento entre as linhas */
    background: none;
    border: none;
    cursor: pointer;
    padding: 10px;
  }

  .hamburger-btn span {
    width: 25px;
    height: 3px;
    background: #333;
    border-radius: 2px;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }
  .hamburger-btn.is-active span:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
  }
  .hamburger-btn.is-active span:nth-child(2) {
    opacity: 0;
  }
  .hamburger-btn.is-active span:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
  }

  /* MENU MOBILE */
  .nav-links-mobile {
    position: fixed;
    top: 0;
    right: -100%;
    width: 75%;
    max-width: 320px;
    height: 100vh;
    background: #fff;
    box-shadow: -3px 0 6px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    padding-top: 5rem;
    transition: right 0.4s ease;
    z-index: 1000;
  }
  .nav-links-mobile.is-active {
    right: 0;
  }
  .nav-links-mobile a {
    padding: 1rem 2rem;
    border-bottom: 1px solid #eee;
    color: #444;
    font-weight: 500;
    text-decoration: none;
  }
  .nav-links-mobile a:not(.btn-mobile):hover {
    background: #fce4ef;
    color: #ff69b4;
    padding-left: 2.5rem;
  }
  .close-btn {
    display: none;
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
  }

  /* MOBILE MEDIA QUERY */
  @media (max-width: 768px) {
    .nav-links-desktop {
      display: none;
    }
    .mobile-controls,
    .hamburger-btn,
    .close-btn {
      display: flex;
    }
  }
</style>

<script defer>
  document.addEventListener("DOMContentLoaded", () => {
    const hamburgerBtn = document.getElementById("hamburger-btn");
    const navMenu = document.getElementById("nav-menu-mobile");
    const closeBtn = document.getElementById("close-btn");

    function toggleMenu(open) {
      const isOpen = open ?? !navMenu.classList.contains("is-active");
      navMenu.classList.toggle("is-active", isOpen);
      hamburgerBtn.classList.toggle("is-active", isOpen);
      hamburgerBtn.setAttribute("aria-expanded", isOpen);
      navMenu.setAttribute("aria-hidden", !isOpen);
      document.body.style.overflow = isOpen ? "hidden" : "";
    }

    hamburgerBtn.addEventListener("click", () => toggleMenu());
    closeBtn.addEventListener("click", () => toggleMenu(false));

    navMenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => toggleMenu(false));
    });

    window.addEventListener("resize", () => {
      if (window.innerWidth > 768) toggleMenu(false);
    });
  });
</script>
{{ end }}
